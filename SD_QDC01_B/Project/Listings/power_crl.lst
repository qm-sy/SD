C51 COMPILER V9.60.7.0   POWER_CRL                                                         06/03/2025 16:23:39 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE POWER_CRL
OBJECT MODULE PLACED IN ..\Output\power_crl.obj
COMPILER INVOKED BY: D:\APP\Keil_v5\C51\BIN\C51.EXE ..\BSP\Src\power_crl.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\BSP\
                    -Inc;..\Core\Inc;..\Driver;..\Emembed\Inc;..\SYSTEM\Inc) DEBUG OBJECTEXTEND PRINT(.\Listings\power_crl.lst) OBJECT(..\Out
                    -put\power_crl.obj)

line level    source

   1          #include "power_crl.h"
   2          
   3          AC_DC ac_dc;
   4          GONGLV gonglv;
   5          
   6          /**
   7           * @brief       ÁßªÁõ∏Ëß¶ÂèëË∞ÉÁî®ÁªìÊûÑ‰ΩìÂàùÂßãÂåñ
   8           *
   9           * @param   
  10           *
  11           * @return  void
  12          **/
  13          void Power_Statu_Init( void )
  14          {
  15   1          ac_dc.zero_flag  = 0;
  16   1          ac_dc.ac220_flag = 0;
  17   1          temp.temp_scan_flag = 0;
  18   1          AC_Out1 = AC_Out2 = AC_Out3 = 1;
  19   1      }
  20          
  21          /**
  22           * @brief       ÂäüÁéáËÆ°Êó∂ÂàùÂßãÂåñ
  23           *
  24           * @param   
  25           *
  26           * @return  void
  27          **/
  28          void Power_consumption_Init( void )
  29          {
  30   1          gonglv.gonglv_cnt = 0;
  31   1          gonglv.gonglv_min = 0;
  32   1          gonglv.gonglv_h = 0;
  33   1          gonglv.gonglv_record_flag = 0;
  34   1      }
  35          
  36          /**
  37           * @brief       Â§ñÈÉ®‰∏≠Êñ≠0‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞
  38           *
  39           * @param   
  40           *
  41           * @return  void
  42          **/
  43          void INT0_ISR( void ) interrupt 0
  44          {
  45   1          /* 1, Ê£ÄÊµãÂà∞Â§ñÈÉ®‰∏≠Êñ≠ÂêéÔºåÁ≠âÂæÖTHL\TLIÂêéËß¶ÂèëTIM1‰∏≠Êñ≠       */
  46   1          TL1 = ac_dc.time_delay;                             
  47   1              TH1 = ac_dc.time_delay >> 8;                            
  48   1      
  49   1          ac_dc.zero_flag = 1;
  50   1          ac_dc.ac220_flag = 1;
  51   1      
  52   1          /* 2, ÂÆöÊó∂Âô®1ÂºÄÂßãËÆ°Êó∂ÔºåÊâìÂºÄTIM1‰∏≠Êñ≠                     */
  53   1          TR1 = 1;                                 
C51 COMPILER V9.60.7.0   POWER_CRL                                                         06/03/2025 16:23:39 PAGE 2   

  54   1          ET1 = 1; 
  55   1      }
  56          
  57          /**
  58           * @brief       Timer1‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞
  59           *
  60           * @param   
  61           *
  62           * @return  void
  63          **/
  64          void Tim1_ISR( void ) interrupt 3   //10ms
  65          {
  66   1          /* 1, ‰∏≠Êñ≠Ëß¶ÂèëÂêéÔºåpower_chÁîµÂπ≥ Áî±È´òÁîµÂπ≥Âèò‰∏∫‰ΩéÁîµÂπ≥           */
  67   1          if( ac_dc.zero_flag == 1 )
  68   1          {
  69   2              ac_dc.zero_flag = 0;
  70   2      
  71   2               /* 2, Ê∏©Â∫¶ÂÖÅËÆ∏Ôºå‰ΩøËÉΩ‰∏∫1Êó∂ÂèØÂºÄÂêØËæìÂá∫          */
  72   2              if(( ac_dc.ac220_out1_enable == 1 ) && (ac_dc.ac220_out_temp_allow == 1))
  73   2              {
  74   3                  AC_Out1 = 0;
  75   3              }
  76   2              if(( ac_dc.ac220_out2_enable == 1 ) && (ac_dc.ac220_out_temp_allow == 1))
  77   2              {
  78   3                  AC_Out2 = 0;
  79   3              }
  80   2              if(( ac_dc.ac220_out3_enable == 1 ) && (ac_dc.ac220_out_temp_allow == 1))
  81   2              {
  82   3                  AC_Out3 = 0;
  83   3              }
  84   2      
  85   2               /* 3, ËÆæÁΩÆ‰∏ã‰∏ÄÊ¨°Timer1‰∏≠Êñ≠Ëß¶ÂèëÊâÄÈúÄÊó∂Èó¥ÔºåÂç≥ËÑâÂÜ≤Êó∂Èó¥       */
  86   2              TL1 = 0xF7;                             
  87   2              TH1 = 0xFF;                             
  88   2          }else
  89   1          {
  90   2              /* 2, ‰∏ã‰∏ÄÊ¨°ËøõÂÖ•Timer1‰∏≠Êñ≠Ôºåpower_chÁîµÂπ≥ Áî±‰ΩéÁîµÂπ≥Âèò‰∏∫È´òÁîµÂπ≥ÔºåÂÆåÊàê‰∏ÄÊ¨°10usË
             -ÑâÂÜ≤ÔºåÂç≥Êñ©Ê≥¢*/
  91   2              AC_Out1 = AC_Out2 = AC_Out3 = 1;
  92   2      
  93   2              /* 3, ÂÆöÊó∂Âô®1ÂÅúÊ≠¢ËÆ°Êó∂ÔºåÂÖ≥Èó≠TIM1‰∏≠Êñ≠ÔºåÁ≠âÂæÖ‰∏ã‰∏ÄÊ¨°Â§ñÈÉ®‰∏≠Êñ≠     */
  94   2              TR1 = 0;                                    
  95   2              ET1 = 0; 
  96   2          }
  97   1      }
  98          
  99          /**
 100           * @brief       220VËæìÂá∫ÂäüÁéáÊéßÂà∂ÂáΩÊï∞ 
 101           *
 102           * @param   power_levelÔºöËæìÂá∫ÂäüÁéáÁôæÂàÜÊØî  0%~100%
 103           *
 104           * @return  void
 105          **/
 106          void ac_220v_crl( uint8_t power_level )
 107          {
 108   1          ac_dc.time_delay = 56500 + 90*power_level;
 109   1      }
 110          
 111          /**
 112           * @brief       24V LEDÂºÄÂÖ≥ÊéßÂà∂ÂáΩÊï∞
 113           *
 114           * @param   on_offÔºö0ÔºöÂÖ≥Èó≠ 1ÔºöÂºÄÂêØ
C51 COMPILER V9.60.7.0   POWER_CRL                                                         06/03/2025 16:23:39 PAGE 3   

 115           *
 116           * @return  void
 117          **/
 118          void led_ctrl( uint8_t on_off )
 119          {
 120   1          if( on_off == FAN_ON )
 121   1          {
 122   2              LED = 0;
 123   2          }else
 124   1          {
 125   2              LED = 1;
 126   2          }
 127   1      }
 128          
 129          /**
 130           * @brief       24V PWMÈ£éÊâáÊ°£‰ΩçÊéßÂà∂ÂáΩÊï∞
 131           *
 132           * @param   level :È£éÊâáÊ°£‰Ωç 0~6Ê°£
 133           *
 134           * @return  void
 135          **/
 136          void fan_ctrl( uint8_t level )
 137          {
 138   1          PWMB_CCR7= level * 184;
 139   1      }
 140          
 141          /**
 142           * @brief       ÂêåÊ≠•ÊéßÂà∂ÂáΩÊï∞ÔºöÊó†Â§ñÈÉ®‰ø°Âè∑Êó∂ PWMÈ£éÊâáÂíå220VËæìÂá∫ÂÖ≥Èó≠
 143           *
 144           * @param   
 145           *
 146           * @return  void
 147          **/
 148          void sync_ctrl( void )
 149          {
 150   1          if( ac_dc.sync_flag == 1 )
 151   1          {
 152   2              if( ac_dc.signal_in_flag == 1 )
 153   2              {
 154   3                  PWMB_BKR = 0x80;    //PWMÊéßÂà∂
 155   3                  EX0 = 1;            //Â§ñÈÉ®‰∏≠Êñ≠ÊéßÂà∂
 156   3              }else
 157   2              {
 158   3                  PWMB_BKR = 0x00; 
 159   3                  EX0 = 0;
 160   3              }
 161   2          }else
 162   1          {
 163   2              PWMB_BKR = 0x80; 
 164   2              EX0 = 1;
 165   2          }
 166   1      }
 167          
 168          /**
 169           * @brief Ê∏©Â∫¶Êâ´ÊèèÔºåDHT11Ê∏©ÊπøÂ∫¶Êâ´Êèè 1s/Ê¨° ÊéßÂà∂220VËæìÂá∫‰ΩøËÉΩ
 170           *
 171           * @param[in] 
 172           * 
 173           * @return  
 174           * 
 175          **/
 176          void temp_scan( void )
C51 COMPILER V9.60.7.0   POWER_CRL                                                         06/03/2025 16:23:39 PAGE 4   

 177          {
 178   1          if( temp.temp_scan_flag == 1)
 179   1          {
 180   2              temp.temp_value1 =  get_temp(NTC);
 181   2      
 182   2              Read_DHT11();
 183   2      
 184   2              if( temp.temp_value1 >= temp.temp_alarm_value )  
 185   2              {
 186   3                  ac_dc.ac220_out_temp_allow = 0;     
 187   3              }else
 188   2              {
 189   3                  ac_dc.ac220_out_temp_allow = 1;     
 190   3              }
 191   2      
 192   2              temp.temp_scan_flag = 0;
 193   2          }
 194   1      }
 195          
 196          /**
 197           * @brief Áî®ÁîµÈáèÁ¥ØËÆ°Êâ´Êèè ‰∏âË∑ØÂÖ®ÂºÄÊª°ÂäüÁéá1minËÆ∞ÂΩï‰∏ÄÊ¨°
 198           *
 199           * @param[in] 
 200           * 
 201           * @return  
 202           * 
 203          **/
 204          void Power_consumption_scan( void )
 205          {
 206   1          if( gonglv.gonglv_record_flag == 1 )
 207   1          {
 208   2              eeprom_data_record(); 
 209   2              gonglv.gonglv_record_flag = 0;
 210   2          }
 211   1      }
 212          
 213          /**
 214           * @brief       Ê®°ÂºèÊéßÂà∂ÂáΩÊï∞ 
 215           *
 216           * @param   
 217           *
 218           * @return  void
 219          **/
 220          void mode_ctrl( uint8_t mode_num )
 221          {
 222   1          switch (mode_num)
 223   1          {
 224   2              case 1:
 225   2                  ac_220v_crl(30);
 226   2                  fan_ctrl(3);
 227   2      
 228   2                  eeprom.ac220_level = 30;
 229   2                  eeprom.pwm_info = 3;
 230   2                  eeprom_data_record();
 231   2      
 232   2                  break;
 233   2      
 234   2              case 2:
 235   2                  ac_220v_crl(50);
 236   2                  fan_ctrl(4);
 237   2      
 238   2                  eeprom.ac220_level = 50;
C51 COMPILER V9.60.7.0   POWER_CRL                                                         06/03/2025 16:23:39 PAGE 5   

 239   2                  eeprom.pwm_info = 4;
 240   2                  eeprom_data_record();
 241   2      
 242   2                  break;
 243   2      
 244   2              case 3:
 245   2                  ac_220v_crl(80);
 246   2                  fan_ctrl(6);
 247   2      
 248   2                  eeprom.ac220_level = 80;
 249   2                  eeprom.pwm_info = 6;
 250   2                  eeprom_data_record();
 251   2      
 252   2                  break;
 253   2      
 254   2              default:
 255   2                  break;
 256   2          }
 257   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    407    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     17    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
